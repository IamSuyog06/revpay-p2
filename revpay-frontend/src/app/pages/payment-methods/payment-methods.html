<app-navbar></app-navbar>

<div class="pm-container">

  <div class="page-header">
    <h1>Payment Methods</h1>
    <button class="btn-add" (click)="toggleAddForm()">
      {{ showAddForm ? 'Cancel' : '+ Add Card' }}
    </button>
  </div>

  <!-- add card form -->
  <div class="form-card" *ngIf="showAddForm">
    <h2>Add New Card</h2>

    <div class="card-type-toggle">
      <button [class.active]="newCard.cardType === 'CREDIT'" (click)="newCard.cardType = 'CREDIT'">
        Credit Card
      </button>
      <button [class.active]="newCard.cardType === 'DEBIT'" (click)="newCard.cardType = 'DEBIT'">
        Debit Card
      </button>
    </div>

    <div class="form-group">
      <label>Card Holder Name</label>
      <input type="text" [(ngModel)]="newCard.cardHolderName" placeholder="Name on card">
    </div>

    <div class="form-group">
      <label>Card Number</label>
      <input
        type="text"
        [(ngModel)]="newCard.cardNumber"
        placeholder="16-digit card number"
        maxlength="16">
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>Expiry Month</label>
        <select [(ngModel)]="newCard.expiryMonth">
          <option value="">MM</option>
          <option *ngFor="let m of [1,2,3,4,5,6,7,8,9,10,11,12]"
            [value]="m < 10 ? '0' + m : '' + m">
            {{ m < 10 ? '0' + m : m }}
          </option>
        </select>
      </div>
      <div class="form-group">
        <label>Expiry Year</label>
        <select [(ngModel)]="newCard.expiryYear">
          <option value="">YYYY</option>
          <option *ngFor="let y of [2025,2026,2027,2028,2029,2030]" [value]="y">{{ y }}</option>
        </select>
      </div>
      <div class="form-group">
        <label>CVV</label>
        <input type="password" [(ngModel)]="newCard.cvv" placeholder="CVV" maxlength="3">
      </div>
    </div>

    <div class="form-group">
      <label>Billing Address</label>
      <input type="text" [(ngModel)]="newCard.billingAddress" placeholder="Enter billing address">
    </div>

    <button class="btn-primary" (click)="onAddCard()" [disabled]="isLoading">
      {{ isLoading ? 'Adding...' : 'Add Card' }}
    </button>
  </div>

  <!-- cards list -->
  <div class="empty-state" *ngIf="paymentMethods.length === 0 && !showAddForm">
    No cards added yet. Click "Add Card" to get started.
  </div>

  <div class="cards-grid">
    <div class="card-item" *ngFor="let pm of paymentMethods" [class.default]="pm.isDefault">

      <div class="card-visual">
        <div class="card-top">
          <span class="card-icon">{{ getCardIcon(pm.cardType) }}</span>
          <span class="card-type">{{ pm.cardType }}</span>
          <span class="default-badge" *ngIf="pm.isDefault">DEFAULT</span>
        </div>
        <div class="card-number">•••• •••• •••• {{ pm.lastFourDigits }}</div>
        <div class="card-bottom">
          <div>
            <div class="card-label">CARD HOLDER</div>
            <div class="card-value">{{ pm.cardHolderName }}</div>
          </div>
          <div>
            <div class="card-label">EXPIRES</div>
            <div class="card-value">{{ pm.expiryMonth }}/{{ pm.expiryYear }}</div>
          </div>
        </div>
      </div>

      <div class="card-actions">
        <button
          class="btn-default"
          *ngIf="!pm.isDefault"
          (click)="onSetDefault(pm.id)">
          Set Default
        </button>
        <button class="btn-delete" (click)="onDeleteCard(pm.id)">Delete</button>
      </div>

    </div>
  </div>

</div>
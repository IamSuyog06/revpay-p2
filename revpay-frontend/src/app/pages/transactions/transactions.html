<app-navbar></app-navbar>

<div class="transactions-container">

  <div class="page-header">
    <h1>Transaction History</h1>
    <button class="btn-export" (click)="onExportCsv()">⬇ Export CSV</button>
  </div>

  <!-- search and filter bar -->
  <div class="search-bar">
    <div class="search-input-wrap">
      <input
        type="text"
        [(ngModel)]="searchKeyword"
        placeholder="Search by name or transaction ID"
        (keyup.enter)="onSearch()">
      <button class="btn-search" (click)="onSearch()">Search</button>
    </div>
    <button class="btn-filter" (click)="toggleFilters()">
      {{ showFilters ? 'Hide Filters' : 'Show Filters' }}
    </button>
  </div>

  <!-- filters panel -->
  <div class="filters-panel" *ngIf="showFilters">
    <div class="filters-grid">

      <div class="form-group">
        <label>Type</label>
        <select [(ngModel)]="filter.type">
          <option value="">All Types</option>
          <option value="SENT">Sent</option>
          <option value="RECEIVED">Received</option>
          <option value="ADDED_FUNDS">Added Funds</option>
          <option value="WITHDRAWAL">Withdrawal</option>
        </select>
      </div>

      <div class="form-group">
        <label>Status</label>
        <select [(ngModel)]="filter.status">
          <option value="">All Status</option>
          <option value="COMPLETED">Completed</option>
          <option value="PENDING">Pending</option>
          <option value="FAILED">Failed</option>
        </select>
      </div>

      <div class="form-group">
        <label>From Date</label>
        <input type="datetime-local" [(ngModel)]="filter.startDate">
      </div>

      <div class="form-group">
        <label>To Date</label>
        <input type="datetime-local" [(ngModel)]="filter.endDate">
      </div>

      <div class="form-group">
        <label>Min Amount (₹)</label>
        <input type="number" [(ngModel)]="filter.minAmount" placeholder="0">
      </div>

      <div class="form-group">
        <label>Max Amount (₹)</label>
        <input type="number" [(ngModel)]="filter.maxAmount" placeholder="999999">
      </div>

    </div>

    <div class="filter-actions">
      <button class="btn-apply" (click)="onFilter()">Apply Filters</button>
      <button class="btn-clear" (click)="onClearFilters()">Clear</button>
    </div>
  </div>

  <!-- transactions list -->
  <div class="transactions-card">

    <div class="loading" *ngIf="isLoading">Loading transactions...</div>

    <div class="empty-state" *ngIf="!isLoading && transactions.length === 0">
      No transactions found
    </div>

    <div class="transaction-item" *ngFor="let tx of transactions">
      <div class="tx-icon" [class]="getAmountColor(tx.type)">
        {{ getTypeIcon(tx.type) }}
      </div>
      <div class="tx-details">
        <div class="tx-title">
          <span *ngIf="tx.type === 'SENT'">Sent to {{ tx.receiverName }}</span>
          <span *ngIf="tx.type === 'RECEIVED'">Received from {{ tx.senderName }}</span>
          <span *ngIf="tx.type === 'ADDED_FUNDS'">Added Funds</span>
          <span *ngIf="tx.type === 'WITHDRAWAL'">Withdrawal</span>
        </div>
        <div class="tx-meta">
          <span class="tx-id">#{{ tx.id }}</span>
          <span class="tx-date">{{ tx.createdAt | date:'MMM d, y, h:mm a' }}</span>
        </div>
        <div class="tx-note" *ngIf="tx.note">{{ tx.note }}</div>
      </div>
      <div class="tx-right">
        <div class="tx-amount" [class]="getAmountColor(tx.type)">
          {{ getAmountSign(tx.type) }}₹{{ tx.amount | number:'1.2-2' }}
        </div>
        <span class="tx-status" [class]="'status-' + tx.status.toLowerCase()">
          {{ tx.status }}
        </span>
      </div>
    </div>

  </div>

</div>